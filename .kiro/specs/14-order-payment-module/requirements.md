# 订单支付模块 - 需求文档

## 模块概述

实现设备推广订单创建、支付、管理和充值功能，支持微信、支付宝、余额三种支付方式。

## 功能需求

### 1. 订单创建页面 (/orders/create)

#### 1.1 推广档位选择
- 推荐位（rankLevel=1）
  - 省级：100元/月
  - 市级：80元/月
  - 区县级：50元/月
- 置顶位（rankLevel=2）
  - 省级：200元/月
  - 市级：150元/月
  - 区县级：100元/月

#### 1.2 推广区域选择
- 省级推广
- 市级推广
- 区县级推广

#### 1.3 推广时长选择
- 1-12个月可选
- 显示单价和总价

#### 1.4 设备信息展示
- 设备型号
- 设备图片
- 当前位置

#### 1.5 价格计算
- 实时计算总价
- 显示优惠（如有）
- 显示应付金额

#### 1.6 提交按钮
- 创建订单
- 跳转支付页面

### 2. 支付页面 (/orders/[id]/pay)

#### 2.1 订单信息展示
- 订单号
- 设备信息
- 推广档位
- 推广区域
- 推广时长
- 应付金额

#### 2.2 支付方式选择
- 微信支付（显示二维码）
- 支付宝支付（显示二维码）
- 余额支付（显示余额，不足时提示充值）

#### 2.3 支付状态
- 待支付
- 支付中（轮询检查）
- 支付成功
- 支付失败

#### 2.4 操作按钮
- 确认支付
- 取消订单
- 返回订单列表

### 3. 订单列表页面 (/orders)

#### 3.1 列表展示
- 订单号
- 设备信息（型号、图片）
- 推广档位
- 推广区域
- 推广时长
- 订单金额
- 支付方式
- 订单状态
- 创建时间

#### 3.2 状态筛选
- 全部
- 待支付
- 已支付
- 已退款
- 已取消

#### 3.3 操作功能
- 查看详情
- 去支付（待支付）
- 申请退款（已支付）
- 取消订单（待支付）

#### 3.4 分页功能
- 每页20条
- 分页导航

### 4. 订单详情页面 (/orders/[id])

#### 4.1 订单信息
- 订单号
- 订单状态
- 创建时间
- 支付时间
- 退款时间（如有）

#### 4.2 设备信息
- 设备型号
- 设备图片
- 设备位置

#### 4.3 推广信息
- 推广档位
- 推广区域
- 推广时长
- 生效时间
- 到期时间

#### 4.4 支付信息
- 订单金额
- 实付金额
- 支付方式
- 退款金额（如有）

#### 4.5 操作按钮
- 去支付（待支付）
- 申请退款（已支付）
- 取消订单（待支付）

### 5. 充值页面 (/recharge)

#### 5.1 充值金额选择
- 预设金额：100、200、500、1000
- 自定义金额（1-10000）

#### 5.2 充值优惠规则
- 充值100送10
- 充值500送50
- 充值1000送150

#### 5.3 支付方式选择
- 微信支付
- 支付宝支付

#### 5.4 当前余额显示
- 显示账户余额

#### 5.5 充值按钮
- 创建充值订单
- 跳转支付页面

### 6. 充值记录页面 (/recharge/history)

#### 6.1 列表展示
- 充值订单号
- 充值金额
- 赠送金额
- 支付方式
- 充值状态
- 充值时间

#### 6.2 状态筛选
- 全部
- 待支付
- 已支付
- 已取消

#### 6.3 分页功能
- 每页20条
- 分页导航

### 7. 支付组件

#### 7.1 支付方式选择器
- 单选框
- 显示支付方式图标
- 显示余额（余额支付）

#### 7.2 二维码展示
- 生成二维码
- 显示支付提示
- 倒计时（15分钟）

#### 7.3 支付状态轮询
- 每3秒检查一次
- 最多轮询100次（5分钟）
- 支付成功后跳转

#### 7.4 支付结果提示
- 成功提示
- 失败提示
- 超时提示

### 8. 退款功能

#### 8.1 退款申请
- 填写退款原因（5-200字符）
- 确认退款金额
- 提交申请

#### 8.2 退款处理
- 自动退款到余额
- 取消设备推广
- 发送通知

#### 8.3 退款限制
- 只能退款已支付订单
- 退款后不可恢复

## 非功能需求

### 性能要求
- 订单创建响应 < 1s
- 支付页面加载 < 2s
- 支付状态轮询间隔 3s

### 用户体验
- 支付流程清晰
- 状态提示及时
- 错误提示明确
- 移动端适配

### 数据安全
- 支付信息加密
- 订单号唯一性
- 防重复支付
- 防恶意退款

## 业务规则

### 订单规则
- 只能为自己的设备创建订单
- 设备必须已发布
- 一个设备同时只能有一个有效推广

### 支付规则
- 订单15分钟内未支付自动取消
- 余额支付即时到账
- 第三方支付需回调确认

### 退款规则
- 已支付订单可申请退款
- 退款金额返回余额
- 退款后推广立即失效

### 充值规则
- 充值金额1-10000元
- 充值优惠自动计算
- 充值成功即时到账

## 技术约束

- 使用Next.js 14 App Router
- 使用TypeScript
- 依赖前端基础设施模块
- 集成第三方支付SDK（模拟）

## 依赖关系

### 前置依赖
- 前端核心基础设施模块（12）
- 后端订单API（已完成）
- 后端充值API（已完成）

### 后续依赖
- 通知系统（支付成功通知）
