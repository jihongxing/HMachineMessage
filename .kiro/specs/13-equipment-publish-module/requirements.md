# 设备发布模块 - 需求文档

## 模块概述

实现设备发布、编辑、管理的完整功能，包括图片上传、地区选择、分类选择、表单验证等核心功能。

## 功能需求

### 1. 设备发布页面 (/equipment/new)

#### 1.1 基本信息
- 设备型号（必填，最多100字符）
- 设备分类（必填，二级级联选择）
- 设备图片（必填，最少1张，最多9张）
- 设备描述（选填，最多500字符）
- 作业能力（选填，最多100字符）

#### 1.2 位置信息
- 省市区（必填，三级级联选择）
- 详细地址（必填，最多200字符）
- 地图定位（选填，可拖拽选点）
- 经纬度（自动获取或手动输入）

#### 1.3 价格信息
- 租赁价格（必填，数字，最多2位小数）
- 价格单位（必填，单选：天/小时）

#### 1.4 联系方式
- 联系电话（必填，手机号格式验证）
- 微信号（选填，最多50字符）

#### 1.5 可用时间
- 开始日期（选填）
- 结束日期（选填）

#### 1.6 操作按钮
- 保存草稿（保存到本地Store）
- 提交发布（提交到后端审核）
- 取消（返回上一页）

### 2. 设备编辑页面 (/equipment/[id]/edit)

#### 2.1 功能要求
- 加载现有设备数据
- 支持所有发布页面的编辑功能
- 保存后重新提交审核
- 权限验证（只能编辑自己的设备）

#### 2.2 状态限制
- 待审核/已拒绝：可编辑
- 已发布/已下架：可编辑
- 已删除：不可编辑

### 3. 我的设备页面 (/profile/equipment)

#### 3.1 列表展示
- 设备缩略图
- 设备型号
- 价格信息
- 发布状态（待审核/已发布/已拒绝/已下架）
- 浏览量/联系量
- 操作按钮

#### 3.2 状态筛选
- 全部
- 待审核
- 已发布
- 已拒绝
- 已下架

#### 3.3 操作功能
- 编辑（跳转编辑页面）
- 删除（软删除，二次确认）
- 上架/下架（切换状态）
- 查看详情（跳转详情页）
- 推广（跳转订单创建页）

#### 3.4 数据统计
- 总设备数
- 已发布数
- 待审核数
- 总浏览量
- 总联系量

### 4. 图片上传组件

#### 4.1 上传功能
- 点击上传
- 拖拽上传
- 粘贴上传
- 多图上传（最多9张）

#### 4.2 图片处理
- 客户端压缩（最大1920x1080）
- 格式转换（转WebP）
- 文件大小限制（单张最大5MB）
- 格式限制（jpg/jpeg/png/webp）

#### 4.3 预览功能
- 缩略图展示
- 大图预览
- 图片排序（拖拽）
- 删除图片

#### 4.4 上传状态
- 上传进度条
- 上传成功提示
- 上传失败提示
- 重新上传

### 5. 地区选择组件

#### 5.1 级联选择
- 省份列表（一级）
- 城市列表（二级，根据省份加载）
- 区县列表（三级，根据城市加载）

#### 5.2 交互功能
- 下拉选择
- 搜索功能
- 清空选择
- 默认值设置

#### 5.3 数据加载
- 懒加载（按需加载下级）
- 数据缓存（避免重复请求）
- 加载状态提示

### 6. 分类选择组件

#### 6.1 级联选择
- 一级分类列表
- 二级分类列表（根据一级加载）

#### 6.2 交互功能
- 下拉选择
- 搜索功能
- 清空选择
- 默认值设置

#### 6.3 数据加载
- 一次性加载树形数据
- 数据缓存
- 加载状态提示

### 7. 表单验证

#### 7.1 实时验证
- 输入时验证
- 失焦时验证
- 提交时验证

#### 7.2 验证规则
- 必填项验证
- 格式验证（手机号、价格等）
- 长度验证
- 自定义验证

#### 7.3 错误提示
- 字段下方显示错误信息
- 错误字段高亮
- 滚动到第一个错误字段

### 8. 草稿功能

#### 8.1 自动保存
- 表单变化时自动保存到Store
- 防抖处理（2秒）

#### 8.2 草稿恢复
- 进入发布页面时检查草稿
- 提示用户是否恢复
- 恢复后清除草稿

#### 8.3 草稿清除
- 提交成功后清除
- 用户主动清除
- 过期自动清除（7天）

## 非功能需求

### 性能要求
- 图片上传速度 < 5s/张
- 页面加载时间 < 2s
- 表单提交响应 < 1s

### 用户体验
- 表单填写流畅
- 错误提示清晰
- 操作反馈及时
- 移动端适配

### 数据安全
- 图片上传前验证
- 表单数据验证
- XSS防护
- CSRF防护

## 业务规则

### 发布限制
- 新用户：10次/天
- 普通用户：50次/天
- 优质用户：无限制

### 审核规则
- 风险评分 < 20：自动通过
- 风险评分 >= 20：人工审核
- 审核时间：24小时内

### 状态流转
```
草稿 → 待审核 → 已发布/已拒绝
已发布 → 已下架
已下架 → 已发布
任意状态 → 已删除
```

## 技术约束

- 使用Next.js 14 App Router
- 使用TypeScript
- 使用React Hook Form表单管理
- 使用Zod表单验证
- 依赖前端基础设施模块（API、Store、UI组件）

## 依赖关系

### 前置依赖
- 前端核心基础设施模块（12-frontend-infrastructure）
- 后端设备API（已完成）
- 后端上传API（已完成）
- 后端分类API（已完成）
- 后端地区API（已完成）

### 后续依赖
- 订单创建模块（推广功能）
- 地图定位模块（地图选点）
